<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Example 1 Differentiating normal cells from EMT transitioning cells</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="EMT_files/libs/clipboard/clipboard.min.js"></script>
<script src="EMT_files/libs/quarto-html/quarto.js"></script>
<script src="EMT_files/libs/quarto-html/popper.min.js"></script>
<script src="EMT_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EMT_files/libs/quarto-html/anchor.min.js"></script>
<link href="EMT_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EMT_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EMT_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EMT_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EMT_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Example 1 Differentiating normal cells from EMT transitioning cells</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Epithelial-mesenchymal transition (EMT) equips breast cancer cells for metastasis and treatment resistance. Detecting of EMT-undergoing cells is challenging because of heterogeneity of cancer cells and phenotypic diversity of EMT-undergoing cells. In the article <a href="https://www.nature.com/articles/s41597-022-01137-4">Mass cytometric and transcriptomic profiling of epithelial-mesenchymal transitions in human mammary cell lines</a>, researchers treated cells from HMLE cell line with TGF$$1 to induce EMT. They measured surface protein markers in both treated and control cells to identify protein markers indicative of EMT. The measurements were conducted from day 2 to day 12 every 2 days using mass flow cytometry; the data is available at <a href="https://data.mendeley.com/datasets/pt3gmyk5r2/2">Mendeley data</a>. In this example, we explore how protein expression of treated and control cells differ and how they both evolve over the course of the experiment period.</p>
<section id="data-pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-pre-processing">Data Pre-processing</h2>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load data</h3>
<p>Researchers collected data from three replicates in each measurement; UMAP visualization showed that cells from the triplicates look similar to each other. We use data from HMLE cell line because UMAP visualization shows overlap between the EMT transitioning and normal cell groups. We apply a logicle transformation with parameters chosen based on range of data values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>adhesion_molecules <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ECadherin"</span>,<span class="st">"CD44"</span>, <span class="st">"CD90"</span>, <span class="st">"EpCAM"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"CD146"</span>, <span class="st">"CD166"</span>, <span class="st">"CD111"</span>, <span class="st">"CD155"</span>, <span class="st">"CD24"</span>, <span class="st">"CD44"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"CD49f"</span>, <span class="st">"CD51"</span>, <span class="st">"Galectin3"</span>, <span class="st">"NCadherin"</span>) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cytoskeletal_proteins <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"K7"</span>, <span class="st">"K8K18"</span>, <span class="st">"K5"</span>, <span class="st">"K14"</span>, <span class="st">"Vimentin"</span>) </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>diverse_function <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CD15"</span>, <span class="st">"CD10"</span>, <span class="st">"CD138"</span>, <span class="st">"Fibronectin"</span>, <span class="st">"Podoplanin"</span>, <span class="st">"CA9"</span>) </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>signaling_molecules <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"EGFR"</span>, <span class="st">"Notch3"</span>, <span class="st">"CD136"</span>, <span class="st">"CD81"</span>) <span class="co"># CCR7 is not in the data</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>proliferation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ki67"</span>,<span class="st">"CyclinB1"</span>, <span class="st">"clCASP3clPARP1"</span>, <span class="st">"IdU"</span>) <span class="co"># IdU is not in the data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>var_names_all <span class="ot">&lt;-</span> <span class="fu">c</span>(adhesion_molecules, cytoskeletal_proteins, diverse_function,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                   signaling_molecules, proliferation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define logicle transformation</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>lgcl <span class="ot">&lt;-</span> <span class="fu">logicleTransform</span>( <span class="at">w =</span> <span class="fl">0.5</span>, <span class="at">t=</span> <span class="dv">10000</span>, <span class="at">m =</span> <span class="dv">5</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">transformList</span>(var_names_all, lgcl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="control-cells" class="level3">
<h3 class="anchored" data-anchor-id="control-cells">Control cells</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>control_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(day <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>)){</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(trip <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    file_control_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"HMLE_d"</span>, <span class="fu">str_pad</span>(day, <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">side =</span> <span class="st">"left"</span>), <span class="st">"_ctrl_TC2_trip"</span>, trip, <span class="st">"_LiveCell.fcs"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">read.FCS</span>(<span class="fu">paste0</span>(data_dir_work, file_control_name), <span class="at">transformation=</span><span class="cn">FALSE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    after <span class="ot">&lt;-</span> <span class="fu">transform</span>(x, trans) <span class="co"># logicle transformation</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    df_new <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(after<span class="sc">@</span>exprs) <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(var_names_all)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">day =</span> day)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    control_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(control_data, df_new)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="treated-cells" class="level3">
<h3 class="anchored" data-anchor-id="treated-cells">Treated cells</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>treated_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(day <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>)){</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(trip <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    file_treated_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"HMLE_d"</span>, <span class="fu">str_pad</span>(day, <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">side =</span> <span class="st">"left"</span>), <span class="st">"_TGFb_TC2_trip"</span>, trip, <span class="st">"_LiveCell.fcs"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">read.FCS</span>(<span class="fu">paste0</span>(data_dir_work, file_treated_name), <span class="at">transformation=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    after <span class="ot">&lt;-</span> <span class="fu">transform</span>(x, trans) <span class="co"># logicle transformation</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    df_new <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(after<span class="sc">@</span>exprs) <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(var_names_all)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">day =</span> day)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    treated_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(treated_data, df_new)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sample-size" class="level3">
<h3 class="anchored" data-anchor-id="sample-size">Sample size</h3>
<p>The total sample size of treated and control groups are given below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Control cells:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Control cells:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(control_data<span class="sc">$</span>day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    2     4     6     8    10    12 
26842 38751 24410 39251 28184 48921 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Treated cells:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Treated cells:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(treated_data<span class="sc">$</span>day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    2     4     6     8    10    12 
19778 30751 20177 18385 20269 32462 </code></pre>
</div>
</div>
</section>
<section id="em-cell-sample-size" class="level3">
<h3 class="anchored" data-anchor-id="em-cell-sample-size">E/M cell sample size</h3>
<p>Researchers mentioned in the article that EMT corresponds to increasing number of cells of mesenchymal (M) phenotype, which is characterized by losses of E-Cadherin and gains in expression of Vimentin. Not all treated cells become M phenotype at the end of 12 days, some became EM phenotype (Vimentin+E-Cadherin+) and some in E1 (Vimentin-ECadherin+) or E2 (Vimentin-ECadhirin-) phenotypes. Researchers used a manual gating based on Vimentin and ECadherin levels to separate cells into these phenotypes. We repeat the same manual gating, with parameters derived from Fig. 1 in the paper and report the number of cells in each phenotye. We work with the full data in subsequent analysis and set the value <code>ECadherin &gt; 2.170</code> and <code>Vimentin &gt; 2.484</code> in the full data to obtain cells of E/M phenotype.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gate for EM phenotype </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>gate_em <span class="ot">&lt;-</span> <span class="fu">rectangleGate</span>(<span class="at">filterId =</span> <span class="st">"EMTM"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">list</span>(<span class="st">"ECadherin"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^</span><span class="fl">1.2</span>, <span class="dv">10</span><span class="sc">^</span><span class="fl">3.5</span>), <span class="st">"Vimentin"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^</span><span class="fl">1.5</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>control_data_em <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(day <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>)){</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(trip <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    file_control_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"HMLE_d"</span>, <span class="fu">str_pad</span>(day, <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">side =</span> <span class="st">"left"</span>), <span class="st">"_ctrl_TC2_trip"</span>, trip, <span class="st">"_LiveCell.fcs"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">read.FCS</span>(<span class="fu">paste0</span>(data_dir_work, file_control_name), <span class="at">transformation=</span><span class="cn">FALSE</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">Subset</span>(x, gate_em) <span class="co"># gating </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    after <span class="ot">&lt;-</span> <span class="fu">transform</span>(x, trans) <span class="co"># logicle transformation</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    df_new <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(after<span class="sc">@</span>exprs) <span class="sc">%&gt;%</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(var_names_all)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">day =</span> day)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    control_data_em <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(control_data_em, df_new)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>treated_data_em <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(day <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">2</span>)){</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(trip <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    file_treated_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"HMLE_d"</span>, <span class="fu">str_pad</span>(day, <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">side =</span> <span class="st">"left"</span>), <span class="st">"_TGFb_TC2_trip"</span>, trip, <span class="st">"_LiveCell.fcs"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">read.FCS</span>(<span class="fu">paste0</span>(data_dir_work, file_treated_name), <span class="at">transformation=</span><span class="cn">FALSE</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">Subset</span>(x, gate_em) <span class="co"># gating </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    after <span class="ot">&lt;-</span> <span class="fu">transform</span>(x, trans) <span class="co"># logicle transformation</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    df_new <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(after<span class="sc">@</span>exprs) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(var_names_all)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">day =</span> day)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    treated_data_em <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(treated_data_em, df_new)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Number of cells in E/M phenotype each day:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Control cells in E/M phenotype:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Control cells in E/M phenotype:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(control_data_em<span class="sc">$</span>day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   2    4    6    8   10   12 
7654 4486 6162 8097 9348 8222 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Treated cells in E/M phenotype:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Treated cells in E/M phenotype:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(treated_data_em<span class="sc">$</span>day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    2     4     6     8    10    12 
10050 18869 14620 13456 13497 18873 </code></pre>
</div>
</div>
</section>
<section id="add-gaussian-noise-to-break-ties" class="level3">
<h3 class="anchored" data-anchor-id="add-gaussian-noise-to-break-ties">Add Gaussian noise to break ties</h3>
<p>We add a small Gaussian noise with mean 0 and std.dev 0.01 to break ties.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>n_control <span class="ot">&lt;-</span> <span class="fu">nrow</span>(control_data)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>d_control <span class="ot">&lt;-</span> <span class="fu">ncol</span>(control_data)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>n_treated <span class="ot">&lt;-</span> <span class="fu">nrow</span>(treated_data)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>d_treated <span class="ot">&lt;-</span> <span class="fu">ncol</span>(treated_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># set seed for reproduce ersult</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>control_data_w_noise <span class="ot">&lt;-</span> control_data <span class="sc">+</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n_control <span class="sc">*</span> d_control, <span class="dv">0</span>, <span class="fl">0.01</span>), n_control, d_control)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>control_data_w_noise<span class="sc">$</span>day <span class="ot">&lt;-</span> control_data<span class="sc">$</span>day</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>treated_data_w_noise <span class="ot">&lt;-</span> treated_data <span class="sc">+</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n_treated <span class="sc">*</span> d_treated, <span class="dv">0</span>, <span class="fl">0.01</span>), n_treated, d_treated)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>treated_data_w_noise<span class="sc">$</span>day <span class="ot">&lt;-</span> treated_data<span class="sc">$</span>day</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="group-data-into-three-periods" class="level3">
<h3 class="anchored" data-anchor-id="group-data-into-three-periods">Group data into three periods</h3>
<p>Next, we group consecutive days into periods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new column called period based on days </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>control_data_w_noise <span class="ot">&lt;-</span> control_data_w_noise <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    day <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    day <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    day <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>) <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>treated_data_w_noise <span class="ot">&lt;-</span> treated_data_w_noise <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    day <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    day <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    day <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>) <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="construct-a-5-dimensional-histogram" class="level2">
<h2 class="anchored" data-anchor-id="construct-a-5-dimensional-histogram">Construct a 5-dimensional histogram</h2>
<p>We construct bounded Beta-trees (exclude one observation at boundaries of each dimension) at 80% confidence level for five protein biomarkers that span several functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ECadherin"</span>, <span class="st">"Vimentin"</span>,<span class="st">"Podoplanin"</span>, <span class="st">"CD44"</span>, <span class="st">"CD136"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.2</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Period: "</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># control cells  </span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  hist_data_control <span class="ot">&lt;-</span> control_data_w_noise <span class="sc">%&gt;%</span> </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(period <span class="sc">==</span> i) <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(var_names))</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bounded histogram</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  hist_control <span class="ot">&lt;-</span> <span class="fu">BuildHist</span>(<span class="fu">as.matrix</span>(hist_data_control), <span class="at">alpha =</span> alpha, </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"weighted_bonferroni"</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bounded =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"ndat"</span>, <span class="at">qt =</span> <span class="fu">rep</span>(<span class="dv">1</span>, d)) </span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  mode_control <span class="ot">&lt;-</span> <span class="fu">FindModesApproximate</span>(<span class="at">hist =</span> hist_control, <span class="at">d =</span> d, <span class="at">L =</span> <span class="dv">50</span>, <span class="at">B =</span> <span class="dv">10000</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># treated cells </span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  hist_data_treated <span class="ot">&lt;-</span> treated_data_w_noise <span class="sc">%&gt;%</span> </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(period <span class="sc">==</span> i) <span class="sc">%&gt;%</span> </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(var_names))</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bounded histogram</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  hist_treated <span class="ot">&lt;-</span> <span class="fu">BuildHist</span>(<span class="fu">as.matrix</span>(hist_data_treated), <span class="at">alpha =</span> alpha, </span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method =</span> <span class="st">"weighted_bonferroni"</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bounded =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">"ndat"</span>, <span class="at">qt =</span> <span class="fu">rep</span>(<span class="dv">1</span>, d))</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  mode_treated <span class="ot">&lt;-</span> <span class="fu">FindModesApproximate</span>(<span class="at">hist =</span> hist_treated, <span class="at">d =</span> d, <span class="at">L =</span> <span class="dv">50</span>, <span class="at">B =</span> <span class="dv">10000</span>)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  result[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">hist_data_control =</span> hist_data_control,</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">hist_control =</span> hist_control,</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">mode_control =</span> mode_control,</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">hist_data_treated =</span> hist_data_treated, </span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">hist_treated =</span> hist_treated, </span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">mode_treated =</span> mode_treated</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="location-of-modes" class="level3">
<h3 class="anchored" data-anchor-id="location-of-modes">Location of modes</h3>
<p>We show the locations of modes identified in treated/control cells during each period below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Period:"</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Control cell, lower end: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  hist_control <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_control"</span>]]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  mode_control <span class="ot">&lt;-</span> result[[i]][[<span class="st">"mode_control"</span>]]<span class="sc">$</span>mode</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">round</span>(hist_control[mode_control,<span class="dv">1</span><span class="sc">:</span>d], <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Ccontrol cell, upper end: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">round</span>(hist_control[mode_control,(d<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>d)], <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Treated cell, lower end : </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  hist_treated <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_treated"</span>]]</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  mode_treated <span class="ot">&lt;-</span> result[[i]][[<span class="st">"mode_treated"</span>]]<span class="sc">$</span>mode</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">round</span>(hist_treated[mode_treated,<span class="dv">1</span><span class="sc">:</span>d], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Treated cell, upper end: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">round</span>(hist_treated[mode_treated,(d<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>d)], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Period: 1 
Control cell, lower end: 
2.93 2.14 2.69 1.78 2.54 
Ccontrol cell, upper end: 
3.12 2.43 2.87 1.98 2.75 
Treated cell, lower end : 
2.968 2.42 3.179 1.935 2.569 
Treated cell, upper end: 
3.147 2.676 3.405 2.092 2.767 
Period: 2 
Control cell, lower end: 
2.94 2.2 2.72 1.8 2.61 
Ccontrol cell, upper end: 
3.12 2.49 2.9 2.02 2.76 
Treated cell, lower end : 
2.899 2.644 3.087 1.69 2.438 
Treated cell, upper end: 
3.037 2.934 3.262 1.958 2.643 
Period: 3 
Control cell, lower end: 
3.2 2.21 2.92 1.94 2.73 
Ccontrol cell, upper end: 
3.31 2.6 3.08 2.12 2.91 
Treated cell, lower end : 
2.907 2.572 2.989 1.424 2.403 
Treated cell, upper end: 
2.989 2.858 3.219 1.794 2.583 </code></pre>
</div>
</div>
<p>From the locations of the cluster centers, we can see that the treated cells has lower levels of E-Cadherin and CD44, and higher levels of Vimentin and Podoplanin.</p>
</section>
<section id="visualize-marginal-distributions" class="level3">
<h3 class="anchored" data-anchor-id="visualize-marginal-distributions">Visualize marginal distributions</h3>
<p>We plot the marginal distribution of <code>Podoplanin</code> and <code>CD44</code> for control and treated cells over the three periods.</p>
<div class="cell" data-result="false">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plot_marginal_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Period: "</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># control cells</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  hist_data_control <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_data_control"</span>]]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  hist_control <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_control"</span>]]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  plot_data_control_marginal <span class="ot">&lt;-</span> <span class="fu">plot_histogram_data</span>(hist_data_control, </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                                             hist_control, d, </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lower_constraint =</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, d), </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">upper_constraint =</span> <span class="fu">rep</span>(<span class="dv">5</span>, d), </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_coord =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">nint =</span> <span class="dv">50</span>, </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_true_density =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  kernel_control <span class="ot">&lt;-</span> <span class="fu">kde2d</span>(<span class="at">x =</span> hist_data_control[,<span class="dv">3</span>], </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> hist_data_control[,<span class="dv">4</span>], </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n =</span> <span class="dv">50</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># treated samples </span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  hist_data_treated <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_data_treated"</span>]]</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  hist_treated <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_treated"</span>]]</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  plot_data_treated_marginal <span class="ot">&lt;-</span> <span class="fu">plot_histogram_data</span>(hist_data_treated, hist_treated, d, </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lower_constraint =</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, d), </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>                                <span class="at">upper_constraint =</span> <span class="fu">rep</span>(<span class="dv">5</span>, d), </span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_coord =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), </span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">nint =</span> <span class="dv">50</span>, </span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_true_density =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># marginal distribution using kernel density estimate </span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  kernel_treated <span class="ot">&lt;-</span> <span class="fu">kde2d</span>(<span class="at">x =</span> hist_data_treated[,<span class="dv">3</span>], </span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> hist_data_treated[,<span class="dv">4</span>], </span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  plot_marginal_data[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_data_control_marginal =</span> plot_data_control_marginal, </span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">kernel_control =</span> kernel_control,</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_data_treated_marginal =</span> plot_data_treated_marginal,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">kernel_treated =</span> kernel_treated</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Period:  1 
Period:  2 
Period:  3 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(type <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"treated"</span>, <span class="st">"control"</span>)){</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> plot_marginal_data[[i]][[<span class="fu">paste0</span>(<span class="st">"plot_data_"</span>, type, <span class="st">"_marginal"</span>)]]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    kernel_est <span class="ot">&lt;-</span> plot_marginal_data[[i]][[<span class="fu">paste0</span>(<span class="st">"kernel_"</span>, type)]]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>( kernel_est<span class="sc">$</span>x, kernel_est<span class="sc">$</span>y)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    grid_val <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> grid[,<span class="dv">1</span>],</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> grid[,<span class="dv">2</span>],</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">z =</span> <span class="fu">as.vector</span>(kernel_est<span class="sc">$</span>z)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(x <span class="sc">&gt;</span> <span class="fl">0.5</span>, y <span class="sc">&gt;</span> <span class="fl">0.5</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"treated"</span>){</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>      title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Period "</span>, i, <span class="st">"  Treated"</span> )</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>      title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Period "</span>, i, <span class="st">"  Control"</span> )</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(fig_dir, <span class="st">"Podoplanin_CD44_marginal_"</span>,i, <span class="st">"_"</span>, type, <span class="st">".png"</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    grid_lower_x <span class="ot">&lt;-</span>  plot_data<span class="sc">$</span>grid_lower[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">1</span>]]</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    grid_upper_x <span class="ot">&lt;-</span> plot_data<span class="sc">$</span>grid_upper[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">1</span>]]</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    grid_lower_y <span class="ot">&lt;-</span>  plot_data<span class="sc">$</span>grid_lower[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">2</span>]]</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    grid_upper_y <span class="ot">&lt;-</span> plot_data<span class="sc">$</span>grid_upper[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">2</span>]]</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    grid_volume <span class="ot">&lt;-</span> (grid_upper_y <span class="sc">-</span> grid_lower_y) <span class="sc">*</span> (grid_upper_x <span class="sc">-</span> grid_lower_x)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    grid_density <span class="ot">&lt;-</span> plot_data<span class="sc">$</span>est_prob[,<span class="dv">1</span>] <span class="sc">/</span> <span class="fu">sum</span>(plot_data<span class="sc">$</span>est_prob[,<span class="dv">1</span>]) <span class="sc">/</span> grid_volume</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> grid_lower_x , </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> grid_upper_x,</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin  =</span> grid_lower_y,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> grid_upper_y, </span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span>  grid_density ) ) <span class="sc">+</span> </span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"#08306b"</span>,<span class="at">mid =</span> <span class="st">"#6baed6"</span>,</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>                           <span class="at">midpoint =</span> <span class="fu">quantile</span>(grid_density, <span class="fl">0.99</span>), </span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>                           <span class="at">aesthetics =</span> <span class="st">"fill"</span>,</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>                           <span class="at">name =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>                       <span class="at">z =</span> z), </span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">quantile</span>(grid_val<span class="sc">$</span>z, <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.85</span>, <span class="fl">0.95</span>)),</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"grey30"</span>, <span class="at">data =</span> grid_val) <span class="sc">+</span> </span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>),</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">4</span>)) <span class="sc">+</span> <span class="co"># see https://ggplot2-book.org/scales-position </span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>), </span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span>  </span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>)</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> title, </span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Podoplanin"</span>, </span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"CD44"</span>) </span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">filename =</span> filename, </span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1254 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 67 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1548 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1036 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 73 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1378 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1285 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 66 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1604 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1158 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 71 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1446 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1601 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 56 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1862 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1106 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 71 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1444 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
</div>
</section>
<section id="visualize-distributions-of-em-cells" class="level3">
<h3 class="anchored" data-anchor-id="visualize-distributions-of-em-cells">Visualize distributions of E/M cells</h3>
<p>Next, we visualize the joint distribution of <code>Podoplanin</code> and <code>CD44</code> for cells exhibiting E/M-phenotype, which we define as cells with <code>ECadherin &gt; 2.170</code> and <code>Vimentin &gt; 2.484</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>plot_conditional_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Period: "</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># control cells</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  hist_data_control <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_data_control"</span>]]</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  hist_control <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_control"</span>]]</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  plot_data_control_conditional <span class="ot">&lt;-</span> <span class="fu">plot_histogram_data</span>(hist_data_control,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>                                                       hist_control, d, </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lower_constraint =</span> <span class="fu">c</span>(<span class="fl">2.170</span>, <span class="fl">2.484</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>), </span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">upper_constraint =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_coord =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">nint =</span> <span class="dv">50</span>, </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_true_density =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  hist_data_control_conditional <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(hist_data_control,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>                                                 ECadherin <span class="sc">&gt;</span> <span class="fl">2.170</span>, Vimentin <span class="sc">&gt;</span> <span class="fl">2.484</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># marginal distribution using kernel density estimate </span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  kernel_control_conditional <span class="ot">&lt;-</span> <span class="fu">kde2d</span>(<span class="at">x =</span> hist_data_control_conditional[,<span class="dv">3</span>],</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> hist_data_control_conditional[,<span class="dv">4</span>],</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># treated cells </span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  hist_data_treated<span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_data_treated"</span>]]</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  hist_treated <span class="ot">&lt;-</span> result[[i]][[<span class="st">"hist_treated"</span>]]</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  plot_data_treated_conditional <span class="ot">&lt;-</span> <span class="fu">plot_histogram_data</span>(hist_data_treated,</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>                                                       hist_treated, d, </span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lower_constraint =</span> <span class="fu">c</span>(<span class="fl">2.170</span>, <span class="fl">2.484</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>), </span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>                                <span class="at">upper_constraint =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>), </span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_coord =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), </span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>                                <span class="at">nint =</span> <span class="dv">50</span>, </span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot_true_density =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>  hist_data_treated_conditional <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(hist_data_treated,</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>                                                 ECadherin <span class="sc">&gt;</span> <span class="fl">2.170</span>, Vimentin <span class="sc">&gt;</span> <span class="fl">2.484</span>)</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># marginal distribution using kernel density estimate </span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  kernel_treated_conditional <span class="ot">&lt;-</span> <span class="fu">kde2d</span>(<span class="at">x =</span> hist_data_treated_conditional[,<span class="dv">3</span>],</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> hist_data_treated_conditional[,<span class="dv">4</span>],</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  plot_conditional_data[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_data_control_conditional =</span> plot_data_control_conditional,</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">kernel_control_conditional =</span> kernel_control_conditional,</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot_data_treated_conditional =</span> plot_data_treated_conditional,</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">kernel_treated_conditional =</span> kernel_treated_conditional</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a><span class="co"># save.image(file = paste0(dir_work, "V2/EMT_5d.RData"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(type <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"treated"</span>, <span class="st">"control"</span>)){</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="ot">&lt;-</span> plot_conditional_data[[i]][[<span class="fu">paste0</span>(<span class="st">"plot_data_"</span>, type, <span class="st">"_conditional"</span>)]]</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    kernel_est <span class="ot">&lt;-</span> plot_conditional_data[[i]][[<span class="fu">paste0</span>(<span class="st">"kernel_"</span>, type, <span class="st">"_conditional"</span>)]]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>( kernel_est<span class="sc">$</span>x, kernel_est<span class="sc">$</span>y)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    grid_val <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> grid[,<span class="dv">1</span>],</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> grid[,<span class="dv">2</span>],</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">z =</span> <span class="fu">as.vector</span>(kernel_est<span class="sc">$</span>z)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span> </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(x <span class="sc">&gt;</span> <span class="fl">0.5</span>, y <span class="sc">&gt;</span> <span class="fl">0.5</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"treated"</span>){</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>      title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Period "</span>, i, <span class="st">" Treated"</span> )</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>      title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Period "</span>, i, <span class="st">" Control"</span> )</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(fig_dir, <span class="st">"Podoplanin_CD44_conditional_"</span>,i, <span class="st">"_"</span>, type, <span class="st">".png"</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    grid_lower_x <span class="ot">&lt;-</span>  plot_data<span class="sc">$</span>grid_lower[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">1</span>]]</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    grid_upper_x <span class="ot">&lt;-</span> plot_data<span class="sc">$</span>grid_upper[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">1</span>]]</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    grid_lower_y <span class="ot">&lt;-</span>  plot_data<span class="sc">$</span>grid_lower[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">2</span>]]</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    grid_upper_y <span class="ot">&lt;-</span> plot_data<span class="sc">$</span>grid_upper[,plot_data<span class="sc">$</span>plot_coord[<span class="dv">2</span>]]</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    grid_volume <span class="ot">&lt;-</span> (grid_upper_y <span class="sc">-</span> grid_lower_y) <span class="sc">*</span> (grid_upper_x <span class="sc">-</span> grid_lower_x)</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    grid_density <span class="ot">&lt;-</span> plot_data<span class="sc">$</span>est_prob[,<span class="dv">1</span>] <span class="sc">/</span> <span class="fu">sum</span>(plot_data<span class="sc">$</span>est_prob[,<span class="dv">1</span>]) <span class="sc">/</span> grid_volume</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> grid_lower_x , </span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> grid_upper_x,</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin  =</span> grid_lower_y,</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> grid_upper_y, </span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span>  grid_density ) ) <span class="sc">+</span> </span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"#08306b"</span>,<span class="at">mid =</span> <span class="st">"#6baed6"</span>,</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>                           <span class="at">midpoint =</span> <span class="fu">quantile</span>(grid_density, <span class="fl">0.99</span>), </span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>                           <span class="at">aesthetics =</span> <span class="st">"fill"</span>,</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>                           <span class="at">name =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>                       <span class="at">z =</span> z), </span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">quantile</span>(grid_val<span class="sc">$</span>z, <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.85</span>, <span class="fl">0.95</span>)),</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"grey30"</span>, <span class="at">data =</span> grid_val) <span class="sc">+</span> </span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>),</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">1.8</span>, <span class="fl">4.2</span>)</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span> <span class="co"># see https://ggplot2-book.org/scales-position </span></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>),</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">3.5</span>)</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span></span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span>  </span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>)</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> title, </span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Podoplanin"</span>, </span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"CD44"</span>) </span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(g, <span class="at">filename =</span> filename, </span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 920 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 78 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1324 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1010 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1198 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1086 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 74 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1460 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 830 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 80 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1240 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 1117 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 73 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1716 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Contour data has duplicated x, y coordinates.
 740 duplicated rows have been dropped.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 82 rows containing non-finite outside the scale range
(`stat_contour()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1270 rows containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>